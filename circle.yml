machine:
  environment:
    XCODE_SCHEME: "Tokopedia"

  xcode:
    version: 9.1

dependencies:
  override:
    - gem install fastlane
    - bundle install

test:
  override:
    - bundle exec danger
    - if [ $CIRCLE_BRANCH = 'feature/UITest' ]; then fastlane test ; fi
  post:
    - if [ $CIRCLE_BRANCH = 'feature/UITest' ]; then mkdir -p $CIRCLE_TEST_REPORTS/junit && cat fastlane/test_output/report.junit > $CIRCLE_TEST_REPORTS/junit/report.xml; fi


general:
  branches:
    only:
      - develop
      - /feature\/.*/
      - /hotfix\/.*/
      - /release\/.*/

deployment:
  devel_distribution:
    branch: [develop, /feature\/.*/]
    commands:
      - fastlane devel

  release_distribution:
    branch: [/hotfix\/.*/, /release\/.*/]
    commands:
      - fastlane beta:
        timeout: 1800


  codepush_distribution:
    branch: [master]
    commands:
      - fastlane codepush    